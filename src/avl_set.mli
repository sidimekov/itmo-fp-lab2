(** Модуль для полиморфного множества на основе AVL-дерева. *)

(** Тип с порядком: элемент множества должен уметь сравниваться. *)
module type OrderedType = sig
  type t
  val compare : t -> t -> int
end

(** Интерфейс множества. Старается быть близким к Set.S из стандартной библиотеки. *)
module type S = sig
  (** Тип элемента множества. *)
  type elt

  (** Тип множества. Реализация скрыта (AVL-дерево). *)
  type t

  (** Пустое множество (нейтральный элемент моноида). *)
  val empty : t

  (** Проверка на пустоту. *)
  val is_empty : t -> bool

  (** Принадлежность элемента множеству. *)
  val mem : elt -> t -> bool

  (** Добавление элемента (иммутабельно). *)
  val add : elt -> t -> t

  (** Удаление элемента (иммутабельно). *)
  val remove : elt -> t -> t

  (** Объединение множеств (операция моноида). *)
  val union : t -> t -> t

  (** Пересечение множеств (для тестов и удобства). *)
  val inter : t -> t -> t

  (** Разность множеств [diff a b] = a \ b. *)
  val diff : t -> t -> t

  (** Количество элементов. *)
  val cardinal : t -> int

  (** Итерация по элементам в порядке возрастания. *)
  val iter : (elt -> unit) -> t -> unit

  (** Свёртка слева (в порядке возрастания). *)
  val fold_left : ('a -> elt -> 'a) -> 'a -> t -> 'a

  (** Свёртка справа (в порядке возрастания, но аргументы в обратном порядке). *)
  val fold_right : (elt -> 'a -> 'a) -> t -> 'a -> 'a

  (** Фильтрация по предикату. *)
  val filter : (elt -> bool) -> t -> t

  (** Отображение. В общем случае может нарушить порядок,
      поэтому либо используем только монотонные функции, либо осторожно в тестах. *)
  val map : (elt -> elt) -> t -> t

  (** Равенство множеств как множеств (по элементам). *)
  val equal : t -> t -> bool

  (** Лексикографическое сравнение множеств по их отсортированным элементам. *)
  val compare : t -> t -> int

  (** Преобразование к списку (по возрастанию). *)
  val to_list : t -> elt list

  (** Построение множества из списка. Дубликаты удаляются. *)
  val of_list : elt list -> t
end

(** Функтор, создающий конкретный модуль множества для данного типа элементов. *)
module Make (Ord : OrderedType) : S with type elt = Ord.t
